<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Acervo Musical - Pesquisa</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
h2 { margin-top: 0; }
input { padding: 6px; width: 300px; margin-bottom: 12px; }
table { border-collapse: collapse; width: 100%; }
th, td { border: 1px solid #ccc; padding: 6px 8px; font-size: 14px; }
th { background: #eee; }
</style>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
</head>
<body>
<h2>Pesquisa no Acervo</h2>
<input type="text" id="search" placeholder="Digite para pesquisar...">
<div id="table-container"></div>

<script>
const tableContainer = document.getElementById("table-container");
const searchInput = document.getElementById("search");

// Função para renderizar a tabela
function renderTable(rows){
    if (!rows.length){ 
        tableContainer.innerHTML = "<p>Nenhum resultado.</p>"; 
        return; 
    }
    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const trh = document.createElement("tr");
    Object.keys(rows[0]).forEach(k => {
        const th = document.createElement("th"); 
        th.textContent = k; 
        trh.appendChild(th);
    });
    thead.appendChild(trh);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    rows.forEach(r => {
        const tr = document.createElement("tr");
        Object.values(r).forEach(v => {
            const td = document.createElement("td"); 
            td.textContent = v; 
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    tableContainer.innerHTML = "";
    tableContainer.appendChild(table);
}

// Carregar CSV externo
Papa.parse("acervo.csv", {
    download: true,
    header: true,
    delimiter: "\t", // use "," se seu CSV for separado por vírgulas
    complete: function(results) {
        const parsed = results.data;

        // Cria colunas extras Vinil/CD/DVD/K7
        parsed.forEach(r => {
            const suporte = r.Obs ? r.Obs.toLowerCase() : "";
            r.Vinil = suporte.includes("vinil") ? "Sim" : "Não";
            r.CD = suporte.includes("cd") ? "Sim" : "Não";
            r.DVD = suporte.includes("dvd") ? "Sim" : "Não";
            r.K7 = suporte.includes("k7") ? "Sim" : "Não";
        });

        // Render inicial
        renderTable(parsed);

        // Filtro de busca
        searchInput.addEventListener("input", () => {
            const q = searchInput.value.toLowerCase();
            const filtered = parsed.filter(r => 
                Object.values(r).some(v => String(v).toLowerCase().includes(q))
            );
            renderTable(filtered);
        });
    }
});
</script>
</body>
</html>
